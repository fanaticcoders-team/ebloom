(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],function($){factory($,window,document);});}else{factory(jQuery,window,document);}})(function($,window,document,undefined){"use strict";var pluginName="countrySelect",id=1,defaults={defaultCountry:"",defaultStyling:"inside",excludeCountries:[],onlyCountries:[],preferredCountries:["us","gb"],responsiveDropdown:true,},keys={UP:38,DOWN:40,ENTER:13,ESC:27,PLUS:43,A:65,Z:90},windowLoaded=false;jQuery(window).on('load',function(){windowLoaded=true;});function Plugin(element,options){this.element=element;this.options=$.extend({},defaults,options);this._defaults=defaults;this.ns="."+pluginName+id++;this._name=pluginName;this.init();}
Plugin.prototype={init:function(){this._processCountryData();this._generateMarkup();this._setInitialState();this._initListeners();this.autoCountryDeferred=new $.Deferred();this._initAutoCountry();return this.autoCountryDeferred;},_processCountryData:function(){allCountries.sort(sort_by('name',false,function(a){return a.toUpperCase()}));this._setInstanceCountryData();this._setPreferredCountries();},_setInstanceCountryData:function(){var that=this;if(this.options.onlyCountries.length){var newCountries=[];$.each(this.options.onlyCountries,function(i,countryCode){var countryData=that._getCountryData(countryCode,true);if(countryData){newCountries.push(countryData);}});this.countries=newCountries;}else if(this.options.excludeCountries.length){var lowerCaseExcludeCountries=this.options.excludeCountries.map(function(country){return country.toLowerCase();});this.countries=allCountries.filter(function(country){return lowerCaseExcludeCountries.indexOf(country.iso2)===-1;});}else{this.countries=allCountries;}},_setPreferredCountries:function(){var that=this;this.preferredCountries=[];$.each(this.options.preferredCountries,function(i,countryCode){var countryData=that._getCountryData(countryCode,false);if(countryData){that.preferredCountries.push(countryData);}});},_generateMarkup:function(){this.countryInput=jQuery(this.element);var mainClass="country-select";if(this.options.defaultStyling){mainClass+=" "+this.options.defaultStyling;}
this.countryInput.wrap(jQuery("<div>",{"class":mainClass}));var flagsContainer=jQuery("<div>",{"class":"flag-dropdown"}).insertAfter(this.countryInput);var selectedFlag=jQuery("<div>",{"class":"selected-flag"}).appendTo(flagsContainer);this.selectedFlagInner=jQuery("<div>",{"class":"flag"}).appendTo(selectedFlag);jQuery("<div>",{"class":"arrow"}).appendTo(selectedFlag);this.countryList=jQuery("<ul>",{"class":"country-list v-hide"}).appendTo(flagsContainer);if(this.preferredCountries.length){this._appendListItems(this.preferredCountries,"preferred");jQuery("<li>",{"class":"divider"}).appendTo(this.countryList);}
this._appendListItems(this.countries,"");this.countryCodeInput=jQuery("#"+this.countryInput.attr("id")+"_code");if(!this.countryCodeInput){this.countryCodeInput=jQuery('<input type="hidden" id="'+this.countryInput.attr("id")+'_code" name="'+this.countryInput.attr("name")+'_code" value="" />');this.countryCodeInput.insertAfter(this.countryInput);}
this.dropdownHeight=this.countryList.outerHeight();if(this.options.responsiveDropdown){jQuery(window).resize(function(){jQuery('.country-select').each(function(i,obj){var dropdownWidth=jQuery(obj).width();jQuery(obj).find('.country-list').css("width",dropdownWidth+"px");});}).resize();}
this.countryList.removeClass("v-hide").addClass("hide");this.countryListItems=this.countryList.children(".country");},_appendListItems:function(countries,className){var tmp="";$.each(countries,function(i,c){tmp+='<li class="country '+className+'" data-country-code="'+c.iso2+'" data-currency-code="'+c.name+'">';tmp+='<div class="flag '+c.iso2+'"></div>';tmp+='<span class="country-name">'+c.name+' ('+c.cur+')'+'</span>';tmp+='</li>';});this.countryList.append(tmp);},_setInitialState:function(){var flagIsSet=false;if(this.countryInput.val()){flagIsSet=this._updateFlagFromInputVal();}
var selectedCode=this.countryCodeInput.val();if(selectedCode){this.selectCountry(selectedCode);}
if(!flagIsSet){var defaultCountry;if(this.options.defaultCountry){defaultCountry=this._getCountryData(this.options.defaultCountry,false);if(!defaultCountry){defaultCountry=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0];}}else{defaultCountry=this.preferredCountries.length?this.preferredCountries[0]:this.countries[0];}
this.defaultCountry=defaultCountry.iso2;}},_initListeners:function(){var that=this;this.countryInput.on("keyup"+this.ns,function(){that._updateFlagFromInputVal();});var selectedFlag=this.selectedFlagInner.parent();selectedFlag.on("click"+this.ns,function(e){if(that.countryList.hasClass("hide")&&!that.countryInput.prop("disabled")){that._showDropdown();}});this.countryInput.on("blur"+this.ns,function(){if(that.countryInput.val()!=that.getSelectedCountryData().name){that.setCountry(that.countryInput.val());}
that.countryInput.val(that.getSelectedCountryData().name);});},_initAutoCountry:function(){if(this.options.initialCountry==="auto"){this._loadAutoCountry();}else{if(this.defaultCountry){this.selectCountry(this.defaultCountry);}
this.autoCountryDeferred.resolve();}},_loadAutoCountry:function(){var that=this;if($.fn[pluginName].autoCountry){this.handleAutoCountry();}else if(!$.fn[pluginName].startedLoadingAutoCountry){$.fn[pluginName].startedLoadingAutoCountry=true;if(typeof this.options.geoIpLookup==='function'){this.options.geoIpLookup(function(countryCode){$.fn[pluginName].autoCountry=countryCode.toLowerCase();setTimeout(function(){jQuery(".country-select input").countrySelect("handleAutoCountry");});});}}},_focus:function(){this.countryInput.focus();var input=this.countryInput[0];if(input.setSelectionRange){var len=this.countryInput.val().length;input.setSelectionRange(len,len);}},_showDropdown:function(){this._setDropdownPosition();var activeListItem=this.countryList.children(".active");this._highlightListItem(activeListItem);this.countryList.removeClass("hide");this._scrollTo(activeListItem);this._bindDropdownListeners();this.selectedFlagInner.parent().children(".arrow").addClass("up");},_setDropdownPosition:function(){var inputTop=this.countryInput.offset().top,windowTop=jQuery(window).scrollTop(),dropdownFitsBelow=inputTop+this.countryInput.outerHeight()+this.dropdownHeight<windowTop+jQuery(window).height(),dropdownFitsAbove=inputTop-this.dropdownHeight>windowTop;var cssTop=!dropdownFitsBelow&&dropdownFitsAbove?"-"+(this.dropdownHeight-1)+"px":"";this.countryList.css("top",cssTop);},_bindDropdownListeners:function(){var that=this;this.countryList.on("mouseover"+this.ns,".country",function(e){that._highlightListItem(jQuery(this));});this.countryList.on("click"+this.ns,".country",function(e){that._selectListItem(jQuery(this));});var isOpening=true;jQuery("html").on("click"+this.ns,function(e){if(!isOpening){that._closeDropdown();}
isOpening=false;});jQuery(document).on("keydown"+this.ns,function(e){e.preventDefault();if(e.which==keys.UP||e.which==keys.DOWN){that._handleUpDownKey(e.which);}else if(e.which==keys.ENTER){that._handleEnterKey();}else if(e.which==keys.ESC){that._closeDropdown();}else if(e.which>=keys.A&&e.which<=keys.Z){that._handleLetterKey(e.which);}});},_handleUpDownKey:function(key){var current=this.countryList.children(".highlight").first();var next=key==keys.UP?current.prev():current.next();if(next.length){if(next.hasClass("divider")){next=key==keys.UP?next.prev():next.next();}
this._highlightListItem(next);this._scrollTo(next);}},_handleEnterKey:function(){var currentCountry=this.countryList.children(".highlight").first();if(currentCountry.length){this._selectListItem(currentCountry);}},_handleLetterKey:function(key){var letter=String.fromCharCode(key);var countries=this.countryListItems.filter(function(){return jQuery(this).text().charAt(0)==letter&&!jQuery(this).hasClass("preferred");});if(countries.length){var highlightedCountry=countries.filter(".highlight").first(),listItem;if(highlightedCountry&&highlightedCountry.next()&&highlightedCountry.next().text().charAt(0)==letter){listItem=highlightedCountry.next();}else{listItem=countries.first();}
this._highlightListItem(listItem);this._scrollTo(listItem);}},_updateFlagFromInputVal:function(){var that=this;var value=this.countryInput.val().replace(/(?=[() ])/g,'\\');if(value){var countryCodes=[];var matcher=new RegExp("^"+value,"i");for(var i=0;i<this.countries.length;i++){if(this.countries[i].name.match(matcher)){countryCodes.push(this.countries[i].iso2);}}
var alreadySelected=false;$.each(countryCodes,function(i,c){if(that.selectedFlagInner.hasClass(c)){alreadySelected=true;}});if(!alreadySelected){this._selectFlag(countryCodes[0]);this.countryCodeInput.val(countryCodes[0]).trigger("change");}
return true;}
return false;},_highlightListItem:function(listItem){this.countryListItems.removeClass("highlight");listItem.addClass("highlight");},_getCountryData:function(countryCode,ignoreOnlyCountriesOption){var countryList=ignoreOnlyCountriesOption?allCountries:this.countries;for(var i=0;i<countryList.length;i++){if(countryList[i].iso2==countryCode){return countryList[i];}}
return null;},_selectFlag:function(countryCode){if(!countryCode){return false;}
this.selectedFlagInner.attr("class","flag "+countryCode);var countryData=this._getCountryData(countryCode);this.selectedFlagInner.parent().attr("title",countryData.name);var listItem=this.countryListItems.children(".flag."+countryCode).first().parent();this.countryListItems.removeClass("active");listItem.addClass("active");},_selectListItem:function(listItem){var countryCode=listItem.attr("data-country-code");this._selectFlag(countryCode);this._closeDropdown();this._updateName(countryCode);this.countryInput.trigger("change");this.countryCodeInput.trigger("change");this._focus();},_closeDropdown:function(){this.countryList.addClass("hide");this.selectedFlagInner.parent().children(".arrow").removeClass("up");jQuery(document).off("keydown"+this.ns);jQuery("html").off("click"+this.ns);this.countryList.off(this.ns);},_scrollTo:function(element){if(!element||!element.offset()){return;}
var container=this.countryList,containerHeight=container.height(),containerTop=container.offset().top,containerBottom=containerTop+containerHeight,elementHeight=element.outerHeight(),elementTop=element.offset().top,elementBottom=elementTop+elementHeight,newScrollTop=elementTop-containerTop+container.scrollTop();if(elementTop<containerTop){container.scrollTop(newScrollTop);}else if(elementBottom>containerBottom){var heightDifference=containerHeight-elementHeight;container.scrollTop(newScrollTop-heightDifference);}},_updateName:function(countryCode){this.countryCodeInput.val(countryCode).trigger("change");this.countryInput.val(this._getCountryData(countryCode).name);},handleAutoCountry:function(){if(this.options.initialCountry==="auto"){this.defaultCountry=$.fn[pluginName].autoCountry;if(!this.countryInput.val()){this.selectCountry(this.defaultCountry);}
this.autoCountryDeferred.resolve();}},getSelectedCountryData:function(){var countryCode=this.selectedFlagInner.attr("class").split(" ")[1];return this._getCountryData(countryCode);},selectCountry:function(countryCode){countryCode=countryCode.toLowerCase();if(!this.selectedFlagInner.hasClass(countryCode)){this._selectFlag(countryCode);this._updateName(countryCode);}},setCountry:function(country){this.countryInput.val(country);this._updateFlagFromInputVal();},destroy:function(){this.countryInput.off(this.ns);this.selectedFlagInner.parent().off(this.ns);var container=this.countryInput.parent();container.before(this.countryInput).remove();}};$.fn[pluginName]=function(options){var args=arguments;if(options===undefined||typeof options==="object"){return this.each(function(){if(!$.data(this,"plugin_"+pluginName)){$.data(this,"plugin_"+pluginName,new Plugin(this,options));}});}else if(typeof options==="string"&&options[0]!=="_"&&options!=="init"){var returns;this.each(function(){var instance=$.data(this,"plugin_"+pluginName);if(instance instanceof Plugin&&typeof instance[options]==="function"){returns=instance[options].apply(instance,Array.prototype.slice.call(args,1));}
if(options==="destroy"){$.data(this,"plugin_"+pluginName,null);}});return returns!==undefined?returns:this;}};$.fn[pluginName].getCountryData=function(){return allCountries;};$.fn[pluginName].setCountryData=function(obj){allCountries=obj;};var allCountries=$.each([{n:"Afghan afghani",i:"af",c:"AFN"},{n:"Albanian lek",i:"al",c:"ALL"},{n:"Algeria dinar",i:"dz",c:"DZD"},{n:"Angolan kwanza",i:"ao",c:"AOA"},{n:"Argentine peso",i:"ar",c:"ARS"},{n:"Armenian dram",i:"am",c:"AMD"},{n:"Aruban florin",i:"aw",c:"AWG"},{n:"Australian dollar",i:"au",c:"AUD"},{n:"Azerbaijani manat",i:"az",c:"AZN"},{n:"Bahamian dollar",i:"bs",c:"BSD"},{n:"Bahraini dinar",i:"bh",c:"BHD"},{n:"Bangladeshi taka",i:"bd",c:"BDT"},{n:"Barbadian dollar",i:"bb",c:"BBD"},{n:"Belarusian ruble",i:"by",c:"BYR"},{n:"Belize dollar",i:"bz",c:"BZD"},{n:"Bermudian dollar",i:"bm",c:"BMD"},{n:"Bhutanese ngultrum",i:"bt",c:"BTN"},{n:"Bolivian boliviano",i:"bo",c:"BOB"},{n:"Bosnia and Herzegovina convertible mark",i:"ba",c:"BAM"},{n:"Botswana pula",i:"bw",c:"BWP"},{n:"Brazilian real",i:"br",c:"BRL"},{n:"British pound",i:"gb",c:"GBP"},{n:"Brunei dollar",i:"bn",c:"BND"},{n:"Bulgarian lev",i:"bg",c:"BGN"},{n:"Burundian franc",i:"bi",c:"BIF"},{n:"Cambodian riel",i:"kh",c:"KHR"},{n:"Canada",i:"ca",c:"CAD"},{n:"Cape Verdean escudo",i:"cv",c:"CVE"},{n:"Cayman islands dollar",i:"ky",c:"KYD"},{n:"Central African CFA franc",i:"cf",c:"XAF"},{n:"CFP franc",i:"pf",c:"XPF"},{n:"Chilean peso",i:"cl",c:"CLP"},{n:"Chinese yuan",i:"cn",c:"CNY"},{n:"Colombian peso",i:"co",c:"COP"},{n:"Congolese franc",i:"cd",c:"CDF"},{n:"Costa Rican colón",i:"cr",c:"CRC"},{n:"Croatian kuna",i:"hr",c:"HRK"},{n:"Cuban convertible peso",i:"cu",c:"CUP"},{n:"Czech koruna",i:"cz",c:"CZK"},{n:"Djiboutian franc",i:"dj",c:"DJF"},{n:"Dominican peso",i:"do",c:"DOP"},{n:"Danish Krone",i:"dk",c:"DKK"},{n:"Egyptian pound",i:"eg",c:"EGP"},{n:"Eritrean nakfa",i:"er",c:"ERN"},{n:"European union",i:"eu",c:"EUR"},{n:"East Caribbean dollar",i:"lc",c:"XCD"},{n:"Ethiopian birr",i:"et",c:"ETB"},{n:"Falkland Islands pound",i:"fk",c:"FKP"},{n:"Fijian dollar",i:"fj",c:"FJD"},{n:"Gambian dalasi",i:"gm",c:"GMD"},{n:"Georgian lari",i:"ge",c:"GEL"},{n:"Ghana cedi",i:"gh",c:"GHS"},{n:"Guatemalan quetzal",i:"gt",c:"GTQ"},{n:"Guinean franc",i:"gn",c:"GNF"},{n:"Guyanese dollar",i:"gy",c:"GYD"},{n:"Haitian gourde",i:"ht",c:"HTG"},{n:"Honduran lempira",i:"hn",c:"HNL"},{n:"Hong Kong dollar",i:"hk",c:"HKD"},{n:"Hungarian forint",i:"hu",c:"HUF"},{n:"Icelandic króna",i:"is",c:"ISK"},{n:"India rupee",i:"in",c:"INR"},{n:"Indonesian rupiah",i:"id",c:"IDR"},{n:"Iranian rial",i:"ir",c:"IRR"},{n:"Iraqi dinar",i:"iq",c:"IQD"},{n:"Israeli new shekel",i:"il",c:"ILS"},{n:"Jamaican dollar",i:"jm",c:"JMD"},{n:"Japanese yen",i:"jp",c:"JPY"},{n:"Jersey pound",i:"je",c:"JEP"},{n:"Jordanian dinar",i:"jo",c:"JOD"},{n:"Kazakhstani tenge",i:"kz",c:"KZT"},{n:"Kenyan shilling",i:"ke",c:"KES"},{n:"Kuwaiti dinar",i:"kw",c:"KWD"},{n:"Kyrgyzstani som",i:"kg",c:"KGS"},{n:"Lebanese pound",i:"lb",c:"LBP"},{n:"Latvian lats",i:"lv",c:"LVL"},{n:"Lesotho loti",i:"ls",c:"LSL"},{n:"Liberian dollar",i:"lr",c:"LRD"},{n:"Libyan dinar",i:"ly",c:"LYD"},{n:"Lithuanian litas",i:"lt",c:"LTL"},{n:"Macedonian denar",i:"mk",c:"MKD"},{n:"Malawian kwacha",i:"mw",c:"MWK"},{n:"Malaysian ringgit",i:"my",c:"MYR"},{n:"Maldivian rufiyaa",i:"mv",c:"MVR"},{n:"Mauritanian ouguiya",i:"mr",c:"MRO"},{n:"Mauritian rupee",i:"mu",c:"MUR"},{n:"Mexicon peso",i:"mx",c:"MXN"},{n:"Moldovan leu",i:"md",c:"MDL"},{n:"Mongolian tögrög",i:"mn",c:"MNT"},{n:"Moroccan dirham",i:"ma",c:"MAD"},{n:"Mozambican metical",i:"mz",c:"MZN"},{n:"Namibian dollar",i:"na",c:"NAD"},{n:"Nepalese rupee",i:"np",c:"NPR"},{n:"New Taiwan dollar",i:"tw",c:"TWD"},{n:"New Zealand dollar",i:"nz",c:"NZD"},{n:"Nicaraguan córdoba",i:"ni",c:"NIO"},{n:"Nigeria naira",i:"ng",c:"NGN"},{n:"North Korean won",i:"kp",c:"KPW"},{n:"Norwegian krone",i:"no",c:"NOK"},{n:"Omani rial",i:"om",c:"OMR"},{n:"Pakistani rupee",i:"pk",c:"PKR"},{n:"Panamanian balboa",i:"pa",c:"PAB"},{n:"Papua New Guinean kina",i:"pg",c:"PGK"},{n:"Paraguayan guaraní",i:"py",c:"PYG"},{n:"Peruvian nuevo sol",i:"pe",c:"PEN"},{n:"Philippine peso",i:"ph",c:"PHP"},{n:"Polish złoty",i:"pl",c:"PLN"},{n:"Qatari riyal",i:"qa",c:"QAR"},{n:"Romanian leu",i:"ro",c:"RON"},{n:"Russian ruble",i:"ru",c:"RUB"},{n:"Rwandan franc",i:"rw",c:"RWF"},{n:"Saint Helena pound",i:"sh",c:"SHP"},{n:"Salvadoran colón",i:"sv",c:"SVC"},{n:"Samoan t�?l�?",i:"ws",c:"WST"},{n:"São Tomé and Príncipe dobra",i:"st",c:"STD"},{n:"Saudi riyal",i:"sa",c:"SAR"},{n:"Serbian dinar",i:"rs",c:"RSD"},{n:"Seychellois rupee",i:"sc",c:"SCR"},{n:"Sierra Leonean leone",i:"sl",c:"SLL"},{n:"Singapore dollar",i:"sg",c:"SGD"},{n:"Solomon Islands dollar",i:"sb",c:"SBD"},{n:"Somali shilling",i:"so",c:"SOS"},{n:"South African rand",i:"za",c:"ZAR"},{n:"South Korean won",i:"kr",c:"KRW"},{n:"South Sudanese pound",i:"ss",c:"SSP"},{n:"Sri Lankan rupee",i:"lk",c:"LKR"},{n:"Sudan",i:"sd",c:"SDG"},{n:"Surinamese dollar",i:"sr",c:"SRD"},{n:"Swazi lilangeni",i:"sz",c:"SZL"},{n:"Swedish krona",i:"se",c:"SEK"},{n:"Switzerland",i:"ch",c:"CHF"},{n:"Syrian pound",i:"sy",c:"SYP"},{n:"Tajikistani somoni",i:"tj",c:"TJS"},{n:"Tanzanian shilling",i:"tz",c:"TZS"},{n:"Thai baht",i:"th",c:"THB"},{n:"Tongan paʻanga",i:"to",c:"TOP"},{n:"Trinidad and Tobago dollar",i:"tt",c:"TTD"},{n:"Tunisian dinar",i:"tn",c:"TND"},{n:"Turkish lira",i:"tr",c:"TRY"},{n:"Turkmenistan manat",i:"tm",c:"TMT"},{n:"Ugandan shilling",i:"ug",c:"UGX"},{n:"Ukrainian hryvnia",i:"ua",c:"UAH"},{n:"United Arab Emirates dirham",i:"ae",c:"AED"},{n:"United states dollar",i:"us",c:"USD"},{n:"Uruguayan peso",i:"uy",c:"UYI"},{n:"Uzbekistani som",i:"uz",c:"UZS"},{n:"Vanuatu vatu",i:"vu",c:"VUV"},{n:"Venezuelan bolívar",i:"ve",c:"VEF"},{n:"Vietnamese đồng",i:"vn",c:"VND"},{n:"West African CFA franc",i:"bf",c:"XOF"},{n:"Yemeni rial",i:"ye",c:"YER"},{n:"Zambian kwacha",i:"zm",c:"ZMW"},{n:"Zimbabwean dollar",i:"zw",c:"ZWL"}],function(i,c){c.name=c.c;c.iso2=c.i;c.cur=c.n;delete c.n;delete c.i;delete c.c;});var sort_by=function(field,reverse,primer){var key=primer?function(x){return primer(x[field])}:function(x){return x[field]};reverse=!reverse?1:-1;return function(a,b){return a=key(a),b=key(b),reverse*((a>b)-(b>a));}}});